<!DOCTYPE html>
<html class="bg-black text-white scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opti AI | Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Triple Dot Animation for the Thinking Feature */
        .typing-dot { animation: blink 1.4s infinite both; font-size: 24px; }
        .typing-dot:nth-child(2) { animation-delay: .2s; }
        .typing-dot:nth-child(3) { animation-delay: .4s; }
        @keyframes blink { 0% { opacity: .2; } 20% { opacity: 1; } 100% { opacity: .2; } }

        /* Custom scrollbar for that clean look */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #0891b2; border-radius: 10px; }

        .glass-panel {
            background: rgba(8, 145, 178, 0.05);
            border: 1px solid rgba(8, 145, 178, 0.2);
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="flex justify-between items-center px-8 py-4 border-b border-cyan-900/50 bg-black/80 backdrop-blur-md sticky top-0 z-10">
        <div class="flex items-center gap-3">
            <div class="w-3 h-3 bg-cyan-500 rounded-full animate-pulse"></div>
            <h1 class="text-cyan-400 font-bold tracking-[0.2em] uppercase text-sm">Opti AI Knowledge Bank</h1>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-gray-500 text-[10px] font-mono hidden md:block">ENCRYPTION: AES-256</span>
            <span class="bg-cyan-900/30 text-cyan-400 text-[10px] px-3 py-1 rounded-full border border-cyan-500/30">
                USER: {{ user_id }}
            </span>
        </div>
    </header>

    <main id="chat-box" class="flex-1 overflow-y-auto p-4 md:p-10">
        <div class="max-w-5xl mx-auto space-y-8">
            
            <div class="text-center">
                <span class="text-gray-600 text-[10px] uppercase tracking-widest font-mono">--- Secure Connection Established ---</span>
            </div>

            <div id="dynamic-content" class="space-y-8">
                <div class="flex justify-start animate-fade-in">
                    <div class="glass-panel p-6 rounded-2xl rounded-tl-none max-w-[85%] md:max-w-[70%] text-gray-200 leading-relaxed shadow-lg">
                        <p class="font-mono text-cyan-400 text-xs mb-2 uppercase tracking-tighter">Opti AI Intelligence:</p>
                        {{ initial_msg }}
                    </div>
                </div>
            </div>

            <div id="loader" class="hidden flex items-center gap-3 text-cyan-500/80 italic font-mono text-sm px-2">
                <span>Analyzing specs & databases</span>
                <span class="flex gap-1">
                    <span class="typing-dot">.</span><span class="typing-dot">.</span><span class="typing-dot">.</span>
                </span>
            </div>

        </div>
    </main>

    <footer class="p-4 md:p-8 bg-gradient-to-t from-black via-black to-transparent">
        <div class="max-w-5xl mx-auto relative">
            <form id="ask-form" class="group">
                <input 
                    type="text" 
                    id="user-query" 
                    autofocus
                    placeholder="Input your specs or ask a question..." 
                    class="w-full bg-gray-900/50 border border-cyan-900/50 p-5 md:p-6 rounded-2xl text-white text-lg outline-none focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400/50 transition-all pr-32 shadow-2xl"
                >
                <button 
                    type="submit" 
                    class="absolute right-3 top-3 bottom-3 bg-cyan-600 hover:bg-cyan-400 text-black px-8 rounded-xl font-black transition-all transform active:scale-95 flex items-center gap-2"
                >
                    <span class="hidden md:block">SEND</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                    </svg>
                </button>
            </form>
            <p class="text-[10px] text-gray-600 text-center mt-4 tracking-widest uppercase">Elite Optimization Engine v2.0.26</p>
        </div>
    </footer>

    <script>
        const form = document.getElementById('ask-form');
        const chatBox = document.getElementById('dynamic-content');
        const loader = document.getElementById('loader');
        const mainContainer = document.getElementById('chat-box');

        form.onsubmit = async (e) => {
            e.preventDefault();
            const queryInput = document.getElementById('user-query');
            const query = queryInput.value.trim();
            if(!query) return;

            // 1. Add User Message to Chat
            chatBox.innerHTML += `
                <div class="flex justify-end">
                    <div class="bg-gray-800/80 border border-gray-700 p-5 rounded-2xl rounded-tr-none max-w-[85%] md:max-w-[70%] text-white shadow-xl">
                        ${query}
                    </div>
                </div>`;
            
            queryInput.value = '';
            
            // 2. Show Loader & Scroll
            loader.classList.remove('hidden');
            mainContainer.scrollTo({ top: mainContainer.scrollHeight, behavior: 'smooth' });

            try {
                // 3. Send to Server
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `query=${encodeURIComponent(query)}`
                });
                
                const result = await response.text();
                
                // 4. Hide Loader & Add AI Response
                loader.classList.add('hidden');
                chatBox.innerHTML += `
                    <div class="flex justify-start animate-fade-in">
                        <div class="glass-panel p-6 rounded-2xl rounded-tl-none max-w-[85%] md:max-w-[70%] text-gray-200 leading-relaxed shadow-lg whitespace-pre-line">
                            <p class="font-mono text-cyan-400 text-[10px] mb-2 uppercase tracking-tighter">Opti AI Intelligence:</p>
                            ${result}
                        </div>
                    </div>`;
                
                mainContainer.scrollTo({ top: mainContainer.scrollHeight, behavior: 'smooth' });
            } catch (err) {
                loader.classList.add('hidden');
                console.error("Transmission Error:", err);
            }
        };
    </script>
</body>
</html>
