<!DOCTYPE html>
<html class="bg-black text-white">
<head>
    <title>Opti AI | Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .typing-dot { animation: blink 1.4s infinite both; font-size: 24px; }
        .typing-dot:nth-child(2) { animation-delay: .2s; }
        .typing-dot:nth-child(3) { animation-delay: .4s; }
        @keyframes blink { 0% { opacity: .2; } 20% { opacity: 1; } 100% { opacity: .2; } }
    </style>
</head>
<body class="flex flex-col h-screen p-6">
    <div class="flex justify-between border-b border-cyan-900 pb-4 mb-4">
        <h1 class="text-cyan-400 font-bold tracking-widest uppercase">Opti AI Knowledge Bank</h1>
        <span class="text-green-500 text-xs">CONNECTED: {{ user_id }}</span>
    </div>

    <div id="chat-box" class="flex-1 overflow-y-auto space-y-6 px-4 md:px-20 lg:px-40">
        <div class="text-gray-500 text-sm italic">System initialized... Awaiting commands.</div>
        <div id="dynamic-content" class="space-y-6"></div>
        <div id="loader" class="hidden flex items-center gap-2 text-cyan-500 italic">
            Opti AI is calculating<span class="typing-dot">.</span><span class="typing-dot">.</span><span class="typing-dot">.</span>
        </div>
    </div>

    <div class="mt-6 px-4 md:px-20 lg:px-40 pb-10">
        <form id="ask-form" class="relative">
            <input id="user-query" placeholder="Ask anything about FPS or Latency..." 
                class="w-full bg-gray-900 border border-cyan-900 p-5 rounded-xl text-lg outline-none focus:border-cyan-400 transition-all pr-32">
            <button type="submit" class="absolute right-3 top-3 bottom-3 bg-cyan-600 text-black px-6 rounded-lg font-bold hover:bg-cyan-400">
                EXECUTE
            </button>
        </form>
    </div>

    <script>
        const form = document.getElementById('ask-form');
        const chatBox = document.getElementById('dynamic-content');
        const loader = document.getElementById('loader');

        form.onsubmit = async (e) => {
            e.preventDefault();
            const query = document.getElementById('user-query').value;
            if(!query) return;

            // Add User Message
            chatBox.innerHTML += `<div class="text-right"><p class="inline-block bg-gray-800 p-4 rounded-2xl max-w-md">${query}</p></div>`;
            document.getElementById('user-query').value = '';
            
            // Show Loader
            loader.classList.remove('hidden');
            window.scrollTo(0, document.body.scrollHeight);

            const response = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `query=${encodeURIComponent(query)}`
            });
            
            const result = await response.text();
            
            // Hide Loader & Add AI Message
            loader.classList.add('hidden');
            chatBox.innerHTML += `<div class="text-left animate-fade-in"><div class="bg-cyan-950/20 border border-cyan-900 p-6 rounded-2xl whitespace-pre-line text-gray-200">${result}</div></div>`;
            window.scrollTo(0, document.body.scrollHeight);
        };
    </script>
</body>
</html>
