<!DOCTYPE html>
<html class="h-full bg-black">
<head>
    <meta charset="UTF-8">
    <title>Opti AI | Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .sidebar-item { cursor: pointer; transition: all 0.3s; }
        .sidebar-item.active { background: rgba(34, 211, 238, 0.1); border-left: 4px solid #06b6d4; opacity: 1; }
        .sidebar-item:not(.active) { opacity: 0.5; }
        body { background: url('https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExNHJueXF4eXF4eXF4eXF4eXF4eXF4eXF4eXF4eXF4eXF4eXF4JmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1n/3o7TKMGpxx32dqRlzO/giphy.gif') center/cover no-repeat fixed; }
    </style>
</head>
<body class="flex h-screen overflow-hidden p-4 gap-4 text-gray-200">

    <aside class="w-64 glass rounded-[2.5rem] flex flex-col p-6 shadow-2xl">
        <div class="p-4 border-b border-white/5 text-center mb-8">
            <h2 class="text-xl font-black italic text-cyan-400">OPTI AI</h2>
            <p class="text-[8px] uppercase tracking-[0.3em] opacity-40">Elite Tuner</p>
        </div>

        <nav class="flex-1 space-y-2">
            <div id="btn-opti" onclick="setMode('optimizer')" class="sidebar-item active flex items-center gap-4 px-6 py-4 rounded-2xl">
                <span>âš¡</span> <span class="text-sm font-bold">Optimizer</span>
            </div>
            <div id="btn-pro" onclick="setMode('pro')" class="sidebar-item flex items-center gap-4 px-6 py-4 rounded-2xl">
                <span>ðŸŽ®</span> <span class="text-sm font-bold">Pro Settings</span>
            </div>
        </nav>

        <a href="/logout" class="p-5 glass rounded-3xl flex items-center justify-center gap-3 hover:bg-cyan-500/10 transition-all border-white/5">
            <span class="text-[10px] font-black text-gray-400 tracking-widest hover:text-white transition-colors">LOG OUT</span>
        </a>
    </aside>

    <main class="flex-1 flex flex-col glass rounded-[2.5rem] overflow-hidden">
        <div class="p-6 border-b border-white/5 flex justify-between bg-white/5">
            <span id="current-mode-label" class="text-[10px] font-bold uppercase tracking-widest text-cyan-500">Optimizer Mode</span>
            <span class="text-[10px] font-mono opacity-40">ID: {{ user_id }}</span>
        </div>

        <div id="chat-box" class="flex-1 overflow-y-auto p-10 space-y-6">
            <div class="flex gap-4">
                <div class="w-10 h-10 rounded-xl glass flex items-center justify-center">ðŸ¤–</div>
                <div class="max-w-xl p-6 rounded-3xl rounded-tl-none glass border-white/10 text-sm text-gray-300">
                    {{ initial_msg }}
                </div>
            </div>
        </div>

        <div class="p-8 bg-black/40 border-t border-white/5">
            <form id="chat-form" class="flex gap-4 max-w-4xl mx-auto">
                <input type="text" id="user-input" placeholder="Enter command..." autocomplete="off"
                    class="flex-1 bg-transparent border-b-2 border-white/10 py-3 outline-none focus:border-cyan-500 transition-all text-sm">
                <button type="submit" class="bg-cyan-600 hover:bg-cyan-500 px-10 rounded-2xl font-black text-[10px] uppercase tracking-widest transition-all">Execute</button>
            </form>
        </div>
    </main>

    <script>
        let currentMode = 'optimizer';

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-opti').classList.toggle('active', mode === 'optimizer');
            document.getElementById('btn-pro').classList.toggle('active', mode === 'pro');
            document.getElementById('current-mode-label').innerText = mode === 'pro' ? 'Pro Settings Mode' : 'Optimizer Mode';
            
            // UI Feedback for mode change
            const chat = document.getElementById('chat-box');
            chat.innerHTML += `<div class="text-center text-[10px] uppercase tracking-widest opacity-20 my-4">â€” Switched to ${mode} â€”</div>`;
        }

        const form = document.getElementById('chat-form');
        form.onsubmit = async (e) => {
            e.preventDefault();
            const input = document.getElementById('user-input');
            const val = input.value;
            if(!val) return;
            input.value = '';

            document.getElementById('chat-box').innerHTML += `<div class="flex justify-end"><div class="max-w-md p-5 rounded-3xl rounded-tr-none glass border-cyan-500/20 text-sm italic text-cyan-200">> ${val}</div></div>`;
            
            const resp = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `query=${encodeURIComponent(val)}&mode=${currentMode}`
            });
            const text = await resp.text();
            
            document.getElementById('chat-box').innerHTML += `<div class="flex gap-4"><div class="w-10 h-10 rounded-xl glass flex items-center justify-center">ðŸ¤–</div><div class="max-w-xl p-6 rounded-3xl rounded-tl-none glass border-white/10 text-sm text-gray-300">${text}</div></div>`;
            document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
        };
    </script>
</body>
</html>
