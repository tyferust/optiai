<!DOCTYPE html>
<html class="h-full bg-[#0a0a0a]">
<head>
    <title>Opti AI | Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CLEAN SOLID UI */
        .panel { background: #121212; border: 1px solid #1f1f1f; }
        .sidebar-chat { transition: 0.2s; cursor: pointer; border-radius: 12px; }
        .sidebar-chat:hover { background: #1a1a1a; }
        .sidebar-chat.active { background: #1c2b2e; border: 1px solid #06b6d4; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="flex h-screen p-4 gap-4 text-gray-100">

    <aside class="w-72 panel rounded-3xl flex flex-col p-5 shadow-2xl">
        <div class="mb-8 px-2">
            <h1 class="text-xl font-black italic text-cyan-500">OPTI AI</h1>
            <p class="text-[8px] uppercase tracking-widest opacity-30">v3.0 Premium</p>
        </div>

        <div class="flex-1 space-y-4">
            <p class="text-[9px] font-bold text-gray-600 uppercase tracking-widest px-2">Conversations</p>
            
            <div id="tab-optimizer" onclick="switchChat('optimizer')" class="sidebar-chat active p-4">
                <div class="flex items-center gap-3">
                    <span class="text-cyan-500">âš¡</span>
                    <div class="overflow-hidden">
                        <p class="text-xs font-bold truncate">Architect Mode</p>
                        <p class="text-[9px] opacity-40">System Optimization</p>
                    </div>
                </div>
            </div>

            <div id="tab-pro" onclick="switchChat('pro')" class="sidebar-chat p-4">
                <div class="flex items-center gap-3">
                    <span class="text-yellow-500">ðŸŽ®</span>
                    <div class="overflow-hidden">
                        <p class="text-xs font-bold truncate">Pro Settings</p>
                        <p class="text-[9px] opacity-40">eSports Database</p>
                    </div>
                </div>
            </div>
        </div>

        <a href="/logout" class="mt-auto p-4 bg-red-500/5 border border-red-500/10 rounded-2xl text-center hover:bg-red-500/10 transition-all">
            <span class="text-[10px] font-bold text-red-500 uppercase tracking-widest">Logout</span>
        </a>
    </aside>

    <main class="flex-1 panel rounded-3xl flex flex-col overflow-hidden">
        <header class="p-4 px-8 border-b border-white/5 flex justify-between items-center bg-[#151515]">
            <span id="mode-title" class="text-[10px] font-black uppercase tracking-widest text-cyan-500">Architect Core</span>
            <div class="flex gap-2">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-[9px] opacity-40 uppercase">System Linked</span>
            </div>
        </header>

        <div id="chat-box" class="flex-1 overflow-y-auto p-8 space-y-6">
            </div>

        <div class="p-6 bg-[#0e0e0e] border-t border-white/5">
            <form id="chat-form" class="max-w-4xl mx-auto flex gap-4">
                <input type="text" id="user-input" placeholder="Enter command..." autocomplete="off"
                    class="flex-1 bg-transparent border-b border-white/10 outline-none focus:border-cyan-500 py-2 text-sm transition-all">
                <button type="submit" class="bg-cyan-600 hover:bg-cyan-500 px-8 py-3 rounded-xl font-bold text-[10px] uppercase">Execute</button>
            </form>
        </div>
    </main>

    <script>
        let currentMode = 'optimizer';
        const chatBox = document.getElementById('chat-box');

        // Initial Load
        window.onload = () => switchChat('optimizer');

        async function switchChat(mode) {
            currentMode = mode;
            
            // Update Sidebar UI
            document.querySelectorAll('.sidebar-chat').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${mode}`).classList.add('active');
            
            // Update Header
            const title = document.getElementById('mode-title');
            title.innerText = mode === 'optimizer' ? 'Architect Core' : 'Pro Engine';
            title.style.color = mode === 'optimizer' ? '#06b6d4' : '#eab308';

            // Clear and Load History (from hidden storage or simple reload logic)
            chatBox.innerHTML = '<p class="text-center opacity-20 text-[10px] uppercase tracking-widest">-- Link Established --</p>';
            
            // Fetch greetings manually or handle via state
            const initialMsg = mode === 'optimizer' ? 
                "âš¡ **System Online.** Welcome to the Architect core. Please provide your **Specs**, **Platform**, and the **Games** you want to optimize." :
                "ðŸŽ® **Pro Data Engine Active.** Which game are we looking at today?";
            
            addMessage('ðŸ¤–', initialMsg, 'ai');
        }

        function addMessage(icon, text, type) {
            const side = type === 'user' ? 'justify-end' : 'justify-start';
            const color = type === 'user' ? 'border-cyan-500/20 bg-cyan-500/5' : 'border-white/5 bg-white/5';
            chatBox.innerHTML += `
                <div class="flex ${side} animate-fade-in">
                    <div class="max-w-xl p-5 border ${color} rounded-2xl text-sm leading-relaxed">
                        <span class="mr-2">${icon}</span> ${text}
                    </div>
                </div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        document.getElementById('chat-form').onsubmit = async (e) => {
            e.preventDefault();
            const input = document.getElementById('user-input');
            const val = input.value;
            if(!val) return;
            input.value = '';

            addMessage('ðŸ‘¤', val, 'user');
            
            const resp = await fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `query=${encodeURIComponent(val)}&mode=${currentMode}`
            });
            const text = await resp.text();
            addMessage('ðŸ¤–', text, 'ai');
        };
    </script>
</body>
</html>
